<!doctype html>
<html>
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>ANATALEB</title>

    <!-- Minimal critical CSS & preinit state -->
    <style>
      /* Keep background stable and app hidden until we’re truly ready */
      html.preinit, html.preinit body { background:#fff; }
      html.preinit app-root { visibility:hidden }
      #preloader { position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
                   background:#fff; z-index:9999; font:600 14px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif }
      #preloader.hide { display:none }
    </style>

    <!-- Set lang/dir BEFORE any render -->
    <script>
      (function () {
        try {
          document.documentElement.classList.add('preinit');
          var saved = sessionStorage.getItem('anataleb.lang');
          var lang = (saved === 'en' || saved === 'ar') ? saved : 'ar';
          var dir  = (lang === 'ar') ? 'rtl' : 'ltr';
          var el   = document.documentElement;
          el.setAttribute('lang', lang);
          el.setAttribute('dir',  dir);
          window.__ANATALEB_STARTUP_LANG__ = lang; // used in app.config.ts
          
          // Load Google Identity Services with the detected language
          var gisScript = document.createElement('script');
          gisScript.src = 'https://accounts.google.com/gsi/client?hl=' + lang;
          gisScript.async = true;
          gisScript.defer = true;
          document.head.appendChild(gisScript);
        } catch(e) {}
      })();
    </script>
  </head>
  <body>
    <!-- Tiny branded preloader -->
<div id="preloader" role="status" aria-live="polite" aria-label="Loading">
  <span class="spinner" aria-hidden="true"></span>
  <span class="sr-only"></span>
</div>

    <app-root></app-root>

    <!-- Reveal app when Angular + i18n + fonts are ready -->
    <script>
      var hasRevealed = false;
      var reveal = function () {
        if (hasRevealed) return;
        hasRevealed = true;
        document.documentElement.classList.remove('preinit');
        var p = document.getElementById('preloader'); if (p) p.classList.add('hide');
      };
      
      // Listen for the ready event
      window.addEventListener('AnatalebReady', function(){
        if (document.fonts && document.fonts.ready) {
          document.fonts.ready.then(reveal).catch(reveal);
        } else { reveal(); }
      });
      
      // Fallback timeout to prevent infinite loading
      setTimeout(function() {
        if (!hasRevealed) {
          console.warn('App ready timeout - revealing anyway');
          reveal();
        }
      }, 5000); // 5 second timeout
    </script>
  </body>
</html>

<style>
  /* Keep background stable and app hidden until we’re truly ready */
  html.preinit, html.preinit body { background:#fff; }
  html.preinit app-root { visibility:hidden }

  /* Preloader container */
  #preloader{
    position:fixed; inset:0;
    display:flex; align-items:center; justify-content:center;
    background:#fff; z-index:9999;
  }
  #preloader.hide{ display:none }

  /* Spinner */
  .spinner{
    inline-size:48px; block-size:48px;         /* 48x48 circle */
    border-radius:50%;
    border:3px solid #e9eef7;                  /* track */
    border-top-color:#2563EB;                  /* brand blue */
    animation:spin .8s linear infinite;
  }

  /* Accessible hidden text for screen readers */
  .sr-only{
    position:absolute !important;
    width:1px !important; height:1px !important;
    padding:0 !important; margin:-1px !important;
    overflow:hidden !important; clip:rect(0,0,0,0) !important;
    white-space:nowrap !important; border:0 !important;
  }

  @keyframes spin{
    to { transform: rotate(360deg); }
  }

  /* Respect users who prefer reduced motion */
  @media (prefers-reduced-motion:reduce){
    .spinner{ animation: none; border-top-color:#2563EB }
  }
</style>
