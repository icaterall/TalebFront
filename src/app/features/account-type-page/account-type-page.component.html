<div class="account-type-page">
  <!-- Header styled like teacher header -->
  <header class="app-header" *ngIf="user">
    <div class="brand">
      <img src="assets/logo-dark-t.png" alt="Ana Taleb" class="logo-img">
      <span class="org">{{ userName }}</span>
    </div>

    <div class="spacer"></div>

    <button class="language-btn" aria-label="Change language" (click)="toggleLanguage()">
      <span class="lang-dot" [class.ar]="languageClass==='ar'" [class.en]="languageClass==='en'"></span>
      <span class="lang-text">{{ languageButtonText }}</span>
    </button>

    <div class="user-actions">
      <div class="avatar" *ngIf="!hasAvatar" (click)="toggleUserMenu()">{{ userInitials }}</div>
      <img *ngIf="hasAvatar" [src]="userAvatarUrl" alt="avatar" class="avatar-img" (click)="toggleUserMenu()">

      <div class="user-menu" *ngIf="showUserMenu">
        <button class="menu-item" (click)="logout()">{{ 'general.logout' | translate }}</button>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main class="main-content">
    <div class="content-container">
      <!-- Account Type Selection -->
      <div *ngIf="!showDateOfBirth && !showStudentForm">
        <h1 class="page-title">{{ 'accountType.title' | translate }}</h1>
        
        <div class="card-grid">
          <button class="account-card teacher-card" (click)="choose('Teacher')">
            <div class="card-header">
              <div class="user-type-button__IconWrapper-sc-sabyca-2 OLKcE"><span data-functional-selector="icon" class="icon__Icon-sc-xvsbpg-0 exxNNM" style="display: inline-block; vertical-align: middle; width: 72px; height: 72px;"><svg viewBox="0 0 32 32" focusable="false" stroke="none" stroke-width="0" aria-labelledby="label-4d06a733-cd03-440b-8c11-2d51d36c0459" aria-hidden="true" class="icon__Svg-sc-xvsbpg-1 feLttt"><title id="label-4d06a733-cd03-440b-8c11-2d51d36c0459">Icon</title><path d="M25,7.5H18a1,1,0,0,0-.71.29L16,9.09l-1.29-1.3A1,1,0,0,0,14,7.5H7a1,1,0,0,0-1,1v13a1,1,0,0,0,1,1h6.59l1.7,1.71a1,1,0,0,0,1.42,0l1.7-1.71H25a1,1,0,0,0,1-1V8.5A1,1,0,0,0,25,7.5Zm-11,13H8V9.5h5.59L15,10.91V21.09l-.29-.3A1,1,0,0,0,14,20.5Zm10,0H18a1,1,0,0,0-.71.29l-.29.3V10.91L18.41,9.5H24Z" style="fill: rgb(255, 255, 255);"></path></svg></span></div>
            </div>
            <div class="card-body">{{ 'accountType.teacher' | translate }}</div>
          </button>

          <button class="account-card student-card" (click)="choose('Student')">
            <div class="card-header">
              <div class="icon-circle">
                  <span data-functional-selector="icon" class="icon__Icon-sc-xvsbpg-0 exxNNM" style="display: inline-block; vertical-align: middle; width: 72px; height: 72px;"><svg viewBox="0 0 32 32" focusable="false" stroke="none" stroke-width="0" aria-labelledby="label-903de28c-49c4-4bc7-a552-deb0eb614302" aria-hidden="true" class="icon__Svg-sc-xvsbpg-1 feLttt"><title id="label-903de28c-49c4-4bc7-a552-deb0eb614302">Icon</title><path d="M16,14 C17.6568542,14 19,12.6568542 19,11 C19,9.34314575 17.6568542,8 16,8 C14.3431458,8 13,9.34314575 13,11 C13,12.6568542 14.3431458,14 16,14 Z M16,16 C13.2385763,16 11,13.7614237 11,11 C11,8.23857625 13.2385763,6 16,6 C18.7614237,6 21,8.23857625 21,11 C21,13.7614237 18.7614237,16 16,16 Z M16,19 C13.0269583,19 10.5610282,20.4075601 9.52516483,22.3125 L22.4748352,22.3125 C21.4389718,20.4075601 18.9730417,19 16,19 Z M25,24.3125 L7,24.3125 C7,20.2739178 11.0294373,17 16,17 C20.9705627,17 25,20.2739178 25,24.3125 Z" style="fill: rgb(255, 255, 255);"></path></svg></span>
              </div>
            </div>
            <div class="card-body">{{ 'accountType.student' | translate }}</div>
          </button>
        </div>
      </div>

      <!-- Date of Birth Form -->
      <div *ngIf="showDateOfBirth && !showStudentForm" class="date-of-birth-container">
        <button class="back-button" (click)="goBack()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {{ 'dateOfBirth.back' | translate }}
        </button>
        
        <div class="date-of-birth-card">
          <h1 class="form-title">{{ 'dateOfBirth.title' | translate }}</h1>
          
          <div class="form-container">
            <div class="form-group">
              <label for="day">{{ 'dateOfBirth.day' | translate }}</label>
              <select id="day" [(ngModel)]="selectedDay" class="form-select">
                <option value="">{{ 'dateOfBirth.select' | translate }}</option>
                <option *ngFor="let day of days" [value]="day">{{ day }}</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="month">{{ 'dateOfBirth.month' | translate }}</label>
              <select id="month" [(ngModel)]="selectedMonth" class="form-select">
                <option value="">{{ 'dateOfBirth.select' | translate }}</option>
                <option *ngFor="let month of months" [value]="month.value">{{ month.label }}</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="year">{{ 'dateOfBirth.year' | translate }}</label>
              <select id="year" [(ngModel)]="selectedYear" class="form-select">
                <option value="">{{ 'dateOfBirth.select' | translate }}</option>
                <option *ngFor="let year of years" [value]="year">{{ year }}</option>
              </select>
            </div>
          </div>
          
          <!-- Age Display -->
          <div class="age-display" *ngIf="ageDisplay">
            <svg class="age-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="age-text">{{ ageDisplay }}</span>
          </div>
          
          <button 
            class="continue-button" 
            [disabled]="isContinueDisabled()" 
            (click)="continue()">
            {{ 'dateOfBirth.continue' | translate }}
          </button>
          
          <div class="login-link">
            <span>{{ 'dateOfBirth.haveAnotherAccount' | translate }}</span>
            <a href="#" class="login-link-text" (click)="logout()"> {{ 'dateOfBirth.signOut' | translate }}</a>
          </div>
          
          <div class="info-section">
            <button class="info-toggle" (click)="toggleInfo()">
              <span>{{ 'dateOfBirth.whyNeedDateOfBirth' | translate }}</span>
              <svg class="chevron" [class.rotated]="showInfo" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="info-content" *ngIf="showInfo">
              <p>{{ 'dateOfBirth.explanation' | translate }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Student Registration Form -->
      <div *ngIf="showStudentForm" class="date-of-birth-container">
        <button class="back-button" (click)="goBackToDateOfBirth()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {{ 'studentRegistration.back' | translate }}
        </button>
        
        <div class="date-of-birth-card student-registration-card">
          <h1 class="form-title">{{ 'studentRegistration.title' | translate }}</h1>
          
          <form class="student-form" (ngSubmit)="submitStudentForm()">
            <!-- Row 1: Name and Gender -->
            <div class="form-row">
              <div class="form-group name-field">
                <label for="fullName">{{ 'studentRegistration.fullName' | translate }} <span class="required">*</span></label>
                <input 
                  type="text" 
                  id="fullName" 
                  [(ngModel)]="studentForm.fullName" 
                  name="fullName"
                  class="form-input"
                  [placeholder]="'studentRegistration.fullNamePlaceholder' | translate"
                  maxlength="255"
                  required>
                <div class="error-message" *ngIf="studentFormErrors.fullName">
                  {{ studentFormErrors.fullName }}
                </div>
              </div>
              
              <div class="form-group gender-field">
                <label for="gender">{{ 'studentRegistration.gender' | translate }} <span class="required">*</span></label>
                <select 
                  id="gender" 
                  [(ngModel)]="studentForm.gender" 
                  name="gender"
                  class="form-select">
                  <option value="">{{ 'studentRegistration.selectGender' | translate }}</option>
                  <option value="Male">{{ 'studentRegistration.male' | translate }}</option>
                  <option value="Female">{{ 'studentRegistration.female' | translate }}</option>
                </select>
                <div class="error-message" *ngIf="studentFormErrors.gender">
                  {{ studentFormErrors.gender }}
                </div>
              </div>
            </div>

            <!-- Row 2: Country and State -->
            <div class="form-row">
              <div class="form-group">
                <label for="country">{{ 'studentRegistration.country' | translate }} <span class="required">*</span></label>
                <ng-select
                  id="country"
                  [(ngModel)]="studentForm.countryId"
                  name="country"
                  [placeholder]="'studentRegistration.selectCountry' | translate"
                  [searchable]="true"
                  [clearable]="false"
                  [loading]="loadingCountries"
                  (change)="onCountryChange()"
                  bindLabel="name"
                  bindValue="id"
                  [items]="countries">
                </ng-select>
                <div class="error-message" *ngIf="studentFormErrors.country">
                  {{ studentFormErrors.country }}
                </div>
              </div>
              
              <div class="form-group">
                <label for="state">{{ 'studentRegistration.state' | translate }} <span class="required" *ngIf="states.length > 0">*</span></label>
                <ng-select
                  id="state"
                  [(ngModel)]="studentForm.stateId"
                  name="state"
                  [placeholder]="'studentRegistration.selectState' | translate"
                  [searchable]="true"
                  [clearable]="false"
                  [loading]="loadingStates"
                  [disabled]="!studentForm.countryId || loadingStates"
                  bindLabel="name"
                  bindValue="id"
                  [items]="states">
                </ng-select>
                <div class="error-message" *ngIf="studentFormErrors.state">
                  {{ studentFormErrors.state }}
                </div>
              </div>
            </div>

            <!-- Row 3: Education Stage and Preferred Language -->
            <div class="form-row">
              <div class="form-group">
                <label for="educationStage">{{ 'studentRegistration.educationStage' | translate }} <span class="required">*</span></label>
                <ng-select
                  id="educationStage"
                  [(ngModel)]="studentForm.educationStageId"
                  name="educationStage"
                  [placeholder]="'studentRegistration.selectEducationStage' | translate"
                  [searchable]="true"
                  [clearable]="false"
                  [loading]="loadingEducationStages"
                  bindLabel="name"
                  bindValue="id"
                  [items]="educationStages">
                </ng-select>
                <div class="error-message" *ngIf="studentFormErrors.educationStage">
                  {{ studentFormErrors.educationStage }}
                </div>
              </div>
              
              <div class="form-group">
                <label for="locale">{{ 'studentRegistration.preferredLanguage' | translate }} <span class="required">*</span></label>
                <select 
                  id="locale" 
                  [(ngModel)]="studentForm.locale" 
                  name="locale"
                  class="form-select"
                  required>
                  <option value="ar">{{ 'studentRegistration.arabic' | translate }}</option>
                  <option value="en">{{ 'studentRegistration.english' | translate }}</option>
                  <option value="fr">{{ 'studentRegistration.french' | translate }}</option>
                  <option value="es">{{ 'studentRegistration.spanish' | translate }}</option>
                </select>
              </div>
            </div>
            
            <button 
              type="submit" 
              class="submit-button" 
              [disabled]="isSubmitting">
              <span *ngIf="!isSubmitting">{{ 'studentRegistration.completeRegistration' | translate }}</span>
              <span *ngIf="isSubmitting">{{ 'studentRegistration.submitting' | translate }}</span>
            </button>
            
            <div class="required-fields-note">
              <span>{{ 'general.requiredFields' | translate }} *</span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <app-footer></app-footer>
</div>
