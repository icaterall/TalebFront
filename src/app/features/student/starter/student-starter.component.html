<div class="starter-page" [dir]="isRTL ? 'rtl' : 'ltr'">
  
  <!-- Vibrant Hero Header with Gradient -->
  <div class="hero-header">
    <div class="decorative-shapes">
      <div class="shape-pattern"></div>
      <div class="shape-circle-1"></div>
      <div class="shape-circle-2"></div>
    </div>
    
    <div class="hero-content">
      <div class="badge-group">
        <span class="badge">ğŸ“ {{ stageName }}</span>
        <span class="badge">ğŸŒ {{ countryName }}</span>
      </div>
      <h1>{{ currentLang === 'ar' ? 'âœ¨ Ø£Ù†Ø´Ø¦ Ø¯Ø±Ø³Ùƒ Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' : 'âœ¨ Create Your Course with AI' }}</h1>
      <p class="hero-subtitle">
        {{ currentLang === 'ar' 
          ? 'Ø§Ø®ØªØ± Ù…ÙˆØ¶ÙˆØ¹Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ ÙˆØ³ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙÙŠ Ø¨Ù†Ø§Ø¡ Ø¯Ø±Ø³ Ø§Ø­ØªØ±Ø§ÙÙŠ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.'
          : 'Pick one topic and AI will help you build a professional course step by step.' }}
      </p>
    </div>
  </div>

  <!-- Wizard Card Overlapping Hero -->
  <div class="wizard-card">
    <div class="wizard-card-inner">
    <!-- Wizard Progress -->
    <div class="wizard-progress">
      <div class="progress-step" [ngClass]="{'completed': step2Locked || currentStep > 1, 'current': currentStep === 1 && !step2Locked}">
        <div class="step-circle">
          <ng-container *ngIf="step2Locked || currentStep > 1; else stepOne">
            <span class="check-icon">âœ”</span>
          </ng-container>
          <ng-template #stepOne>1</ng-template>
        </div>
        <div class="step-labels">
          <span class="step-name">{{ currentLang === 'ar' ? 'Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©' : 'Course Basics' }}</span>
        </div>
      </div>
      <div class="progress-step" [ngClass]="{'completed': currentStep > 2, 'current': currentStep === 2, 'pending': currentStep < 2}">
        <div class="step-circle">
          <ng-container *ngIf="currentStep > 2; else stepTwo">
            <span class="check-icon">âœ”</span>
          </ng-container>
          <ng-template #stepTwo>2</ng-template>
        </div>
        <div class="step-labels">
          <span class="step-name">{{ currentLang === 'ar' ? 'Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ù‚Ø³Ø§Ù…' : 'Building Sections' }}</span>
        </div>
      </div>
      <div class="progress-step pending">
        <div class="step-circle">3</div>
        <div class="step-labels">
          <span class="step-name">{{ currentLang === 'ar' ? 'Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆÙ†Ø´Ø±' : 'Review & Publish' }}</span>
        </div>
      </div>
    </div>

    <!-- Wizard Body -->
    <div class="wizard-body">
      <!-- Step 1: Category Selection -->
      <div *ngIf="showStep1" class="step-content step1-content">
        <!-- Read-only Summary (shown when step2Locked is true) -->
        <div class="read-only-summary" *ngIf="step2Locked && selectedCategory" [dir]="isRTL ? 'rtl' : 'ltr'">
          <div class="summary-main">
            <div class="summary-item summary-item-with-action">
              <div class="summary-content">
                <span class="summary-label">{{ currentLang === 'ar' ? 'Ø§Ù„ØªØµÙ†ÙŠÙ:' : 'Category:' }}</span>
                <span class="summary-icon">{{ selectedCategory.icon }}</span>
                <span class="summary-value">{{ getCategoryName(selectedCategory) }}</span>
              </div>
              <button 
                type="button" 
                class="btn-start-from-scratch"
                (click)="showStartFromScratchModal = true"
                [attr.aria-label]="currentLang === 'ar' ? 'Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯' : 'Start from Scratch'">
                <span class="btn-icon">ğŸ”„</span>
                <span class="btn-text">{{ currentLang === 'ar' ? 'Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯' : 'Start from Scratch' }}</span>
              </button>
            </div>
            <div class="summary-item">
              <span class="summary-label">{{ currentLang === 'ar' ? 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:' : 'Course Name:' }}</span>
              <span class="summary-value">
                <span *ngIf="!editingCourseName">{{ courseName }}</span>
                <input 
                  *ngIf="editingCourseName"
                  type="text"
                  class="inline-edit-input"
                  [(ngModel)]="editingCourseNameValue"
                  (keyup.enter)="saveCourseNameEdit()"
                  (keyup.escape)="cancelCourseNameEdit()"
                  [placeholder]="currentLang === 'ar' ? 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©' : 'Course Name'"
                  [dir]="isRTL ? 'rtl' : 'ltr'"
                  maxlength="200">
                <div class="summary-action-buttons">
                  <button *ngIf="!editingCourseName" type="button" class="summary-edit-btn" (click)="startEditingCourseName()" [attr.aria-label]="currentLang === 'ar' ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©' : 'Edit Course Name'">âœï¸</button>
                  <div *ngIf="editingCourseName" class="inline-edit-actions">
                    <button type="button" class="inline-edit-btn inline-edit-cancel" (click)="cancelCourseNameEdit()" [attr.aria-label]="currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel'">âœ•</button>
                    <button type="button" class="inline-edit-btn inline-edit-save" (click)="saveCourseNameEdit()" [attr.aria-label]="currentLang === 'ar' ? 'Ø­ÙØ¸' : 'Save'">âœ“</button>
                  </div>
                </div>
              </span>
            </div>
          </div>
          <div class="summary-cover">
            <div class="cover-box" [class.has-image]="hasCustomCourseCover" [attr.aria-busy]="courseCoverUploading">
              <div class="cover-upload-overlay" *ngIf="courseCoverUploading">
                <div class="cover-progress-bar">
                  <div class="cover-progress-fill" [style.width.%]="courseCoverUploadProgress"></div>
                </div>
                <div class="cover-progress-text">
                  {{ courseCoverUploadProgress > 0 ? (courseCoverUploadProgress | number:'1.0-0') + '%' : (currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...' : 'Processing...') }}
                </div>
              </div>
              <img class="cover-fallback" [src]="defaultCourseCover" [alt]="currentLang === 'ar' ? 'ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©' : 'Default course cover'" />
              <img class="cover-main"
                   [class.loaded]="coverImageLoaded"
                   [src]="courseCoverPreview ?? defaultCourseCover"
                   (load)="onCoverImageLoad()"
                   (error)="onCoverImageError()"
                   [alt]="currentLang === 'ar' ? 'ØµÙˆØ±Ø© ØºÙ„Ø§Ù Ø§Ù„Ù…Ø§Ø¯Ø©' : 'Course cover image'" />
              <div class="cover-placeholder-overlay" *ngIf="!hasCustomCourseCover && !courseCoverUploading">
                <span class="cover-text">{{ currentLang === 'ar' ? 'Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù' : 'Click to upload a cover' }}</span>
                <span class="cover-hint">{{ currentLang === 'ar' ? 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹' : 'Optional â€¢ You can add one later' }}</span>
              </div>
              <button *ngIf="hasCustomCourseCover" type="button" class="cover-remove-btn" (click)="showDeleteCoverModal = true" [disabled]="courseCoverUploading" [attr.aria-label]="currentLang === 'ar' ? 'Ø¥Ø²Ø§Ù„Ø© ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù' : 'Remove cover image'">âœ•</button>
              <input type="file" class="cover-input" accept="image/*" (change)="onCourseCoverSelected($event)" [disabled]="courseCoverUploading">
            </div>
            <div class="cover-error" *ngIf="courseCoverUploadError">{{ courseCoverUploadError }}</div>
          </div>
        </div>

        <!-- Skeleton Loader for Read-only Summary (shown when loading or data is being fetched) -->
        <div class="read-only-summary read-only-summary-skeleton" *ngIf="showSummarySkeleton" [dir]="isRTL ? 'rtl' : 'ltr'">
          <div class="summary-item summary-item-with-action">
            <div class="summary-content">
              <span class="summary-label skeleton-text"></span>
              <span class="summary-icon skeleton-icon"></span>
              <span class="summary-value skeleton-text"></span>
            </div>
            <div class="btn-start-from-scratch skeleton-button"></div>
          </div>
          <div class="summary-item">
            <span class="summary-label skeleton-text"></span>
            <span class="summary-value skeleton-text"></span>
          </div>
        </div>

        <!-- Selected Category Display (Box style with Change button - shown in Step 1) -->
        <div class="selected-display" *ngIf="selectedCategory && !step2Locked">
          <div class="selected-badge">
            <span class="selected-icon">{{ selectedCategory.icon }}</span>
            <div class="selected-info">
              <span class="selected-label">{{ currentLang === 'ar' ? 'Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ù…Ø®ØªØ§Ø±' : 'Selected Category' }}</span>
              <span class="selected-name">{{ getCategoryName(selectedCategory) }}</span>
            </div>
            <button class="change-btn" (click)="clearCategorySelection()">
              {{ currentLang === 'ar' ? 'ØªØºÙŠÙŠØ±' : 'Change' }}
            </button>
          </div>
        </div>

        <!-- Course Title Section (Shows after category selection) -->
        <div class="course-title-section" *ngIf="selectedCategory && !step2Locked">
          <!-- Loading Spinner - hidden when locked -->
          <div class="loading-container" *ngIf="!step2Locked && loadingTitles">
            <div class="spinner"></div>
            <p class="loading-text">{{ currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡...' : 'Loading course name suggestions...' }}</p>
          </div>

          <!-- AI Title Suggestions (Cards) - hidden when locked - shown at top -->
          <div class="title-cards-container" *ngIf="!step2Locked && !loadingTitles && courseTitleSuggestions.length > 0">
            <div class="title-cards-grid">
              <div
                *ngFor="let titleCard of courseTitleSuggestions"
                class="title-card"
                [class.selected]="courseName === titleCard.title"
                (click)="selectTitleSuggestion(titleCard)">
                <div class="title-card-header">
                  <h3 class="title-card-title">{{ titleCard.title }}</h3>
                  <div class="title-card-info" *ngIf="titleCard.rationale" [title]="titleCard.rationale">
                    <span class="info-icon">â„¹ï¸</span>
                  </div>
                </div>
                <p class="title-card-rationale" *ngIf="titleCard.rationale">{{ titleCard.rationale }}</p>
              </div>
            </div>
          </div>

          <!-- Course Name Input with AI Generate Button -->
          <div class="field-group course-name-input-group" *ngIf="!step2Locked">
            <label class="field-label">
              {{ currentLang === 'ar' ? 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©' : 'Course Name' }}
              <span class="required">*</span>
            </label>
            <div class="course-name-input-row">
              <input
                type="text"
                class="course-name-input"
                [(ngModel)]="courseName"
                (input)="onCourseNameChange()"
                [placeholder]="currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©...' : 'Enter course name...'"
                maxlength="80" />
              <button
                type="button"
                class="btn-generate-ai"
                *ngIf="!loadingTitles && courseTitleSuggestions.length === 0"
                (click)="loadTitleSuggestions()"
                [disabled]="loadingTitles">
                <span class="ai-icon">ğŸ¤–</span>
                <span class="btn-text">{{ currentLang === 'ar' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' : 'Generate with AI' }}</span>
              </button>
            </div>
            <div class="field-help">
              <span *ngIf="courseTitleSuggestions.length === 0">
                {{ currentLang === 'ar' ? 'Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' : 'Type the course name manually or click the button to generate suggestions with AI' }}
              </span>
              <span *ngIf="courseTitleSuggestions.length > 0">
                {{ currentLang === 'ar' ? 'Ø§Ø®ØªØ± Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø£Ø¹Ù„Ø§Ù‡ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙŠØ¯ÙˆÙŠØ§Ù‹' : 'Select a title from suggestions above or type the course name manually' }}
              </span>
            </div>
          </div>

          <!-- Topic Selection (shown when title card is selected in Step 1) -->
          <!-- Show topic field only if AI was not used (manual course name entry) -->
          <div class="field-group" *ngIf="courseName && !step2Locked && courseTitleSuggestions.length === 0">
            <label class="field-label" *ngIf="!selectedTopic">
              {{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…' : 'Section' }}
              <span class="required">*</span>
            </label>

            <!-- Stored Topic (one line with underline) - only show when locked (after Continue) -->
            <div class="inline-field-display" *ngIf="selectedTopic && step2Locked" [dir]="isRTL ? 'rtl' : 'ltr'">
              <span class="inline-label">{{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…:' : 'Section:' }}</span>
              <span class="inline-value underlined">{{ selectedTopic }}</span>
            </div>

            <!-- Manual Topic Input (shown when no AI was used) -->
            <div class="topics-section" *ngIf="courseName && !step2Locked && !selectedTopic">
              <div class="topic-input-wrapper">
                <input
                  type="text"
                  class="topic-input-manual"
                  [(ngModel)]="subjectSlug"
                  (input)="onSubjectSlugChange()"
                  [placeholder]="currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…...' : 'Enter section name...'"
                  maxlength="100" />
              </div>
              <div class="field-help">
                {{ currentLang === 'ar' ? 'Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹' : 'Enter the section name manually' }}
              </div>
            </div>
          </div>

          <!-- Topic Selection Cards (shown when AI title card is selected) -->
          <div class="field-group" *ngIf="courseName && !step2Locked && courseTitleSuggestions.length > 0 && availableTopics.length > 0">
            <label class="field-label" *ngIf="!selectedTopic">
              {{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…' : 'Section' }}
              <span class="required">*</span>
            </label>

            <!-- Stored Topic (one line with underline) - only show when locked (after Continue) -->
            <div class="inline-field-display" *ngIf="selectedTopic && step2Locked" [dir]="isRTL ? 'rtl' : 'ltr'">
              <span class="inline-label">{{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…:' : 'Section:' }}</span>
              <span class="inline-value underlined">{{ selectedTopic }}</span>
            </div>

            <!-- Topic Selection Cards (shown until Continue is clicked) -->
            <div class="topics-section" *ngIf="courseName && !step2Locked && availableTopics.length > 0">
              <div class="topics-grid">
                <div
                  *ngFor="let topic of availableTopics; let i = index"
                  class="topic-card"
                  [class.selected]="selectedTopic === topic && editingTopic !== topic"
                  [class.editing]="editingTopic === topic"
                  (click)="selectTopic(topic)">
                  <div class="topic-edit-wrapper">
                    <ng-container *ngIf="editingTopic === topic; else topicDisplayStep1">
                      <input
                        type="text"
                        class="topic-input"
                        [attr.data-topic]="topic"
                        [(ngModel)]="editingTopicValue"
                        (click)="$event.stopPropagation()"
                        (keyup.enter)="saveTopicEdit()"
                        (keyup.escape)="cancelTopicEdit()"
                        [placeholder]="currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…...' : 'Enter section name...'"
                        (blur)="$event.stopPropagation()" />
                    </ng-container>
                    <ng-template #topicDisplayStep1>
                      <span class="topic-text">{{ topic }}</span>
                    </ng-template>
                    <div class="topic-edit-actions">
                      <ng-container *ngIf="editingTopic === topic; else editIconTemplate">
                        <button
                          type="button"
                          class="topic-action-btn topic-cancel-btn"
                          (click)="$event.stopPropagation(); cancelTopicEdit()"
                          [attr.aria-label]="currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel'">
                          <span class="topic-action-icon">âœ•</span>
                        </button>
                        <button
                          type="button"
                          class="topic-action-btn topic-confirm-btn"
                          (click)="$event.stopPropagation(); saveTopicEdit()"
                          [attr.aria-label]="currentLang === 'ar' ? 'ØªØ£ÙƒÙŠØ¯' : 'Confirm'">
                          <span class="topic-action-icon">âœ“</span>
                        </button>
                      </ng-container>
                      <ng-template #editIconTemplate>
                        <button
                          *ngIf="selectedTopic === topic && editingTopic !== topic"
                          type="button"
                          class="topic-action-btn topic-edit-btn"
                          (click)="$event.stopPropagation(); enterTopicEdit(topic)"
                          [attr.aria-label]="currentLang === 'ar' ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…' : 'Edit section'">
                          <span class="topic-action-icon">âœï¸</span>
                        </button>
                      </ng-template>
                    </div>
                  </div>
                </div>
              </div>
              <div class="field-help">
                {{ currentLang === 'ar' ? 'Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±ØŒ Ø«Ù… Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„' : 'Click to select a section, then click the edit icon to edit' }}
              </div>
            </div>
          </div>

        </div>

        <!-- Category Selection (hidden when step2Locked) -->
        <div *ngIf="!selectedCategory && !step2Locked" class="search-section">
        <div class="card-header">
          <h2>ğŸ“š {{ currentLang === 'ar' ? 'Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹' : 'Choose Your Category' }}</h2>
          <p>{{ currentLang === 'ar' ? 'Ø§Ù„Ø£ÙƒØ«Ø± ØµÙ„Ø© Ø¨Ù…Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©' : 'Most relevant for your education stage' }}</p>
        </div>

        <!-- Loading Skeleton -->
        <div class="categories-grid" *ngIf="loading">
          <div class="cat-box skeleton" *ngFor="let i of [1,2,3,4,5,6]"></div>
        </div>

        <!-- Smart Six Categories -->
        <div class="categories-grid" *ngIf="!loading && smartSix.length > 0">
          <div
            *ngFor="let cat of smartSix"
            class="cat-box"
            (click)="selectCategory(cat)">
            <span class="cat-icon">{{ cat.icon }}</span>
            <span class="cat-name">{{ getCategoryName(cat) }}</span>
          </div>
        </div>

        <!-- Search Other Categories -->
        <div class="search-header">
          <span class="search-icon">ğŸ”</span>
          <h3>{{ currentLang === 'ar' ? 'Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¶ÙˆØ¹ Ø¢Ø®Ø±' : 'Or search for another category' }}</h3>
        </div>
        <ng-select
          [items]="allCategories"
          [bindLabel]="currentLang === 'ar' ? 'name_ar' : 'name_en'"
          bindValue="id"
          [searchable]="true"
          [clearable]="true"
          [placeholder]="currentLang === 'ar' ? 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¶ÙˆØ¹...' : 'Search for a category...'"
          [(ngModel)]="selectedCategoryId"
          (change)="onNgSelectChange()">
          <ng-template ng-option-tmp let-item="item">
            <div class="select-option">
              <span class="opt-icon">{{ item.icon }}</span>
              <span class="opt-name">{{ getCategoryName(item) }}</span>
            </div>
          </ng-template>
        </ng-select>
        </div>
      </div>

      <!-- Step 2: Course Basics -->
      <div *ngIf="showStep2" class="step-content step2-content">
        <!-- Header with Change Category Link -->
        <div class="step2-header">
          <button class="change-category-link" (click)="goBack()" *ngIf="selectedCategory">
            <span class="link-icon">â†</span>
            {{ currentLang === 'ar' ? 'ØªØºÙŠÙŠØ± Ø§Ù„ØªØµÙ†ÙŠÙ' : 'Change Category' }}
          </button>
        </div>

        <!-- Category Info - Always show if category is selected -->
        <div class="category-info-wrapper" *ngIf="selectedCategory">
          <div class="field-group category-display-group">
            <div class="inline-field-display" [dir]="isRTL ? 'rtl' : 'ltr'">
              <span class="inline-label">{{ currentLang === 'ar' ? 'Ø§Ù„ØªØµÙ†ÙŠÙ:' : 'Category:' }}</span>
              <span class="inline-icon">{{ selectedCategory.icon }}</span>
              <span class="inline-value">{{ getCategoryName(selectedCategory) }}</span>
            </div>
          </div>
        </div>

        <!-- A) Course Name -->
        <div class="field-group">
          <label class="field-label" *ngIf="!courseName">
            {{ currentLang === 'ar' ? 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©' : 'Course Name' }}
            <span class="required">*</span>
          </label>

          <!-- Stored Course Name (one line with underline) -->
          <div class="inline-field-display" *ngIf="courseName" [dir]="isRTL ? 'rtl' : 'ltr'">
            <span class="inline-label">{{ currentLang === 'ar' ? 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:' : 'Course Name:' }}</span>
            <span class="inline-value underlined">{{ courseName }}</span>
          </div>

          <!-- AI Title Suggestions (Cards) -->
          <div class="title-cards-container" *ngIf="!courseName && courseTitleSuggestions.length > 0">
            <div class="title-cards-grid">
              <div
                *ngFor="let titleCard of courseTitleSuggestions"
                class="title-card"
                [class.selected]="courseName === titleCard.title"
                (click)="selectTitleSuggestion(titleCard)">
                <div class="title-card-header">
                  <h3 class="title-card-title">{{ titleCard.title }}</h3>
                  <div class="title-card-info" *ngIf="titleCard.rationale" title="{{ titleCard.rationale }}">
                    <span class="info-icon">â„¹ï¸</span>
                  </div>
                </div>
                <p class="title-card-rationale" *ngIf="titleCard.rationale">{{ titleCard.rationale }}</p>
              </div>
            </div>
          </div>
          
          <div class="loading-suggestions" *ngIf="loadingTitles">
            {{ currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª...' : 'Loading suggestions...' }}
          </div>

          <!-- Topic Selection -->
          <!-- Show topic field only if AI was not used (manual course name entry) -->
          <div class="field-group" *ngIf="courseName && courseTitleSuggestions.length === 0">
            <label class="field-label" *ngIf="!selectedTopic">
              {{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…' : 'Section' }}
              <span class="required">*</span>
            </label>

            <!-- Stored Topic (one line with underline) - only show when locked (after Continue) -->
            <div class="inline-field-display" *ngIf="selectedTopic && step2Locked" [dir]="isRTL ? 'rtl' : 'ltr'">
              <span class="inline-label">{{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…:' : 'Section:' }}</span>
              <span class="inline-value underlined">{{ selectedTopic }}</span>
            </div>

            <!-- Manual Topic Input (shown when no AI was used) -->
            <div class="topics-section" *ngIf="courseName && !step2Locked && !selectedTopic">
              <div class="topic-input-wrapper">
                <input
                  type="text"
                  class="topic-input-manual"
                  [(ngModel)]="subjectSlug"
                  (input)="onSubjectSlugChange()"
                  [placeholder]="currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…...' : 'Enter section name...'"
                  maxlength="100" />
              </div>
              <div class="field-help">
                {{ currentLang === 'ar' ? 'Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹' : 'Enter the section name manually' }}
              </div>
            </div>
          </div>

          <!-- Topic Selection Cards (shown when AI title card is selected) -->
          <div class="field-group" *ngIf="courseName && courseTitleSuggestions.length > 0 && availableTopics.length > 0">
            <label class="field-label" *ngIf="!selectedTopic">
              {{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…' : 'Section' }}
              <span class="required">*</span>
            </label>

            <!-- Stored Topic (one line with underline) - only show when locked (after Continue) -->
            <div class="inline-field-display" *ngIf="selectedTopic && step2Locked" [dir]="isRTL ? 'rtl' : 'ltr'">
              <span class="inline-label">{{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…:' : 'Section:' }}</span>
              <span class="inline-value underlined">{{ selectedTopic }}</span>
            </div>

            <!-- Topic Selection Cards (shown until Continue is clicked) -->
            <div class="topics-section" *ngIf="courseName && !step2Locked && availableTopics.length > 0">
              <div class="topics-grid">
                <div
                  *ngFor="let topic of availableTopics; let i = index"
                  class="topic-card"
                  [class.selected]="selectedTopic === topic && editingTopic !== topic"
                  [class.editing]="editingTopic === topic"
                  (click)="selectTopic(topic)">
                  <ng-container *ngIf="editingTopic === topic; else topicDisplay">
                    <input
                      type="text"
                      class="topic-input"
                      [(ngModel)]="editingTopicValue"
                      (click)="$event.stopPropagation()"
                      (keyup.enter)="saveTopicEdit()"
                      (keyup.escape)="cancelTopicEdit()"
                      [placeholder]="currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…...' : 'Enter section name...'"
                      (blur)="saveTopicEdit()" />
                  </ng-container>
                  <ng-template #topicDisplay>
                    <div class="topic-content">
                      <span class="topic-text">{{ topic }}</span>
                    </div>
                  </ng-template>
                </div>
              </div>
              <div class="field-help">
                {{ currentLang === 'ar' ? 'Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±ØŒ Ø«Ù… Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„' : 'Click to select a section, then click the edit icon to edit' }}
              </div>
            </div>
          </div>

          <!-- Fallback Topic Input (if no topics from title card) -->
          <div class="field-group" *ngIf="courseName && availableTopics.length === 0 && !selectedTopic && !editingTopic">
            <label class="field-label">
              {{ currentLang === 'ar' ? 'Ø§Ù„Ù‚Ø³Ù…' : 'Section' }}
              <span class="required">*</span>
            </label>
            <ng-select
              [(ngModel)]="subjectSlug"
              (change)="onSubjectSlugChange()"
              [items]="subjectSlugSuggestions"
              [searchable]="true"
              [clearable]="false"
              [placeholder]="currentLang === 'ar' ? 'Ø§Ø®ØªØ± Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† ÙˆØ­Ø¯Ø©...' : 'Select or search for topic...'">
            </ng-select>
            <div class="field-help">
              {{ currentLang === 'ar' ? 'Ù…Ø«Ø§Ù„: physics, algebra, programming' : 'Example: physics, algebra, programming' }}
            </div>
          </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="wizard-actions" [dir]="isRTL ? 'rtl' : 'ltr'">

      
      <button 
        class="btn-continue" 
        [disabled]="!canContinue || savingDraftCourse"
        [attr.aria-busy]="savingDraftCourse"
        *ngIf="step2Locked"
        (click)="continue()">
        <span *ngIf="savingDraftCourse" class="btn-spinner" aria-hidden="true"></span>
        <span *ngIf="!savingDraftCourse" class="btn-icon">ğŸ¤–</span>
        <span>{{ currentLang === 'ar' ? 'Ù…ØªØ§Ø¨Ø¹Ø©' : 'Continue' }}</span>
      </button>
      
      <button 
        class="btn-continue" 
        [disabled]="!canContinue || step2Locked || savingDraftCourse"
        [attr.aria-busy]="savingDraftCourse"
        *ngIf="!step2Locked"
        (click)="continue()">
        <span *ngIf="savingDraftCourse" class="btn-spinner" aria-hidden="true"></span>
        <span *ngIf="!savingDraftCourse" class="btn-icon">ğŸ¤–</span>
        <span>{{ currentLang === 'ar' ? 'Ù…ØªØ§Ø¨Ø¹Ø©' : 'Continue' }}</span>
      </button>
    </div>

    <div class="continue-error" *ngIf="continueErrorMessage" role="alert" aria-live="assertive">
      {{ continueErrorMessage }}
    </div>

    <!-- Warning Modal -->
    <div class="modal-overlay" *ngIf="showWarningModal" (click)="cancelGoBack()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ currentLang === 'ar' ? 'âš ï¸ ØªØ­Ø°ÙŠØ±' : 'âš ï¸ Warning' }}</h3>
        </div>
        <div class="modal-body">
          <p *ngIf="warningModalType === 'goBack'">{{ currentLang === 'ar' 
            ? 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø§Ù„Ø¹ÙˆØ¯Ø©ØŸ Ø³ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯.' 
            : 'All entered data will be deleted. Are you sure you want to go back? You will need to start from scratch.' }}</p>
          <p *ngIf="warningModalType === 'deleteContent'">{{ currentLang === 'ar' 
            ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.' 
            : 'Are you sure you want to delete this content? This action cannot be undone.' }}</p>
        </div>
        <div class="modal-actions">
          <button class="btn-cancel" (click)="cancelGoBack()">
            {{ currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
          </button>
          <button class="btn-confirm" (click)="warningModalType === 'goBack' ? confirmGoBack() : confirmDeleteContent()">
            {{ currentLang === 'ar' ? 'ØªØ£ÙƒÙŠØ¯' : 'Confirm' }}
          </button>
        </div>
      </div>
    </div>

    <!-- AI Hint Modal (shown above text editor modal) -->
    <div class="modal-overlay ai-hint-overlay" *ngIf="showAIHintModal" (click)="cancelAIHint()" style="z-index: 10001;">
      <div class="modal-content ai-hint-modal" (click)="$event.stopPropagation()" style="z-index: 10001;">
        <div class="modal-header">
          <h3>{{ currentLang === 'ar' ? 'ğŸ¤– ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' : 'ğŸ¤– AI Hint (Optional)' }}</h3>
          <button type="button" class="modal-close-btn" (click)="cancelAIHint()" [attr.aria-label]="currentLang === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="hint-field">
            <label class="field-label">{{ currentLang === 'ar' ? 'Ø£Ø¶Ù ØªÙ„Ù…ÙŠØ­Ø§Ù‹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)' : 'Add a hint (optional)' }}</label>
            <textarea 
              class="hint-input"
              [(ngModel)]="aiHint"
              [placeholder]="currentLang === 'ar' ? 'Ù…Ø«Ø§Ù„: Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§ØªØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©ØŒ Ø§Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†...' : 'Example: Focus on fundamentals, use practical examples, make content suitable for beginners...'"
              [dir]="isRTL ? 'rtl' : 'ltr'"
              rows="4"
              maxlength="500"></textarea>
            <div class="field-help">
              {{ currentLang === 'ar' ? 'Ø£Ø¶Ù Ø£ÙŠ ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ø£Ùˆ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆÙ„Ù‘Ø¯' : 'Add any additional guidance or requirements to improve the quality of generated content' }}
            </div>
          </div>
          
          <div class="hint-actions">
            <button type="button" class="btn-skip" (click)="proceedWithAIGeneration(false)">
              {{ currentLang === 'ar' ? 'ØªØ¬Ø§Ù‡Ù„ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©' : 'Skip & Continue' }}
            </button>
            <button type="button" class="btn-continue" (click)="proceedWithAIGeneration(true)">
              {{ currentLang === 'ar' ? 'Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ù„ØªÙ„Ù…ÙŠØ­' : 'Continue with Hint' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Text Editor Modal -->
    <div class="modal-overlay" *ngIf="showTextEditor">
      <div class="modal-content text-editor-modal">
        <div class="modal-header">
          <h3>{{ currentLang === 'ar' ? 'âœï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø¯Ø±Ø³ Ù†ØµÙŠ' : 'âœï¸ Create Text Lesson' }}</h3>
          <button type="button" class="modal-close-btn" (click)="closeTextEditor()" [attr.aria-label]="currentLang === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="subsection-title-field">
            <label class="field-label">{{ currentLang === 'ar' ? 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *' : 'Title *' }}</label>
            <input 
              type="text" 
              class="subsection-title-input"
              [(ngModel)]="subsectionTitle"
              [placeholder]="currentLang === 'ar' ? 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†...' : 'Enter title...'"
              [dir]="isRTL ? 'rtl' : 'ltr'"
              maxlength="200">
            <div class="field-help">{{ currentLang === 'ar' ? 'Ù…Ø«Ø§Ù„: Ù…Ù‚Ø¯Ù…Ø©ØŒ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©' : 'Example: Introduction, Core Concepts, Practical Applications' }}</div>
          </div>
          
          <div class="editor-toolbar">
            <button 
              type="button"
              class="btn-generate-ai"
              [disabled]="generatingWithAI || !subsectionTitle || !subsectionTitle.trim()"
              (click)="generateTextWithAI()">
              <span class="btn-icon">ğŸ¤–</span>
              <span class="btn-text">{{ currentLang === 'ar' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' : 'Generate Text with AI' }}</span>
              <span class="btn-hint">{{ currentLang === 'ar' ? '(Ø³ÙˆÙ ÙŠØ³ØªØºØ±Ù‚ Ø¯Ù‚ÙŠÙ‚Ø©)' : '(Will take a minute)' }}</span>
            </button>
            <div class="ai-generating" *ngIf="generatingWithAI">
              <span class="spinner"></span>
              <span>{{ currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­...' : 'Suggesting...' }}</span>
            </div>
          </div>
          
          <div class="editor-container" [attr.dir]="isRTL ? 'rtl' : 'ltr'">
            <ckeditor 
              [editor]="Editor"
              [config]="editorConfig"
              [(ngModel)]="textContent"
              (ready)="onReady($event)">
            </ckeditor>
          </div>
          
          <div class="editor-actions">
            <button type="button" class="btn-cancel" (click)="closeTextEditor()">
              {{ currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
            </button>
            <button type="button" class="btn-save" [disabled]="!subsectionTitle.trim()" (click)="saveTextContent()">
              {{ currentLang === 'ar' ? 'Ø­ÙØ¸' : 'Save' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Type Creation Modal (AI-assisted or Manual) -->
    <div class="modal-overlay" *ngIf="showContentTypeModal" (click)="closeContentTypeModal()">
      <div class="modal-content content-type-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ getContentTypeModalTitle() }}</h3>
          <button type="button" class="modal-close-btn" (click)="closeContentTypeModal()" [attr.aria-label]="currentLang === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'">âœ•</button>
        </div>
        <div class="modal-body">
          <p class="modal-description">{{ getContentTypeModalDescription() }}</p>
          <div class="creation-options">
            <button 
              type="button"
              class="creation-option-btn ai-option"
              (click)="selectCreationMode('ai')">
              <span class="option-icon">ğŸ¤–</span>
              <span class="option-label">{{ currentLang === 'ar' ? 'Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ' : 'AI-assisted' }}</span>
              <span class="option-desc">{{ currentLang === 'ar' ? 'Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹' : 'Use AI to automatically generate content' }}</span>
            </button>
            
            <button 
              type="button"
              class="creation-option-btn manual-option"
              (click)="selectCreationMode('manual')">
              <span class="option-icon">âœï¸</span>
              <span class="option-label">{{ currentLang === 'ar' ? 'ÙŠØ¯ÙˆÙŠ' : 'Manual' }}</span>
              <span class="option-desc">{{ currentLang === 'ar' ? 'Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†ÙØ³Ùƒ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©' : 'Create content yourself step by step' }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Resource Creation Modal -->
    <div class="modal-overlay" *ngIf="showResourceModal" (click)="closeResourceModal()">
      <div class="modal-content resource-modal" (click)="$event.stopPropagation()" [dir]="isRTL ? 'rtl' : 'ltr'">
        <div class="modal-header">
          <h3>{{ currentLang === 'ar' ? 'ğŸ“„ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯' : 'ğŸ“„ Add Resource' }}</h3>
          <button type="button" class="modal-close-btn" (click)="closeResourceModal()" [attr.aria-label]="currentLang === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="field-group">
            <label class="field-label" for="resourceTitle">{{ currentLang === 'ar' ? 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ±Ø¯ *' : 'Resource Title *' }}</label>
            <input
              id="resourceTitle"
              type="text"
              class="field-input"
              [(ngModel)]="resourceForm.title"
              [placeholder]="currentLang === 'ar' ? 'Ù…Ø«Ø§Ù„: Ø£ÙˆØ±Ø§Ù‚ Ø¹Ù…Ù„ Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰' : 'Example: Unit 1 Worksheets'"
              [dir]="isRTL ? 'rtl' : 'ltr'"
              maxlength="150" />
          </div>

          <div class="field-group">
            <label class="field-label" for="resourceType">{{ currentLang === 'ar' ? 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù' : 'File Type' }}</label>
            <select id="resourceType" class="field-select" [(ngModel)]="resourceForm.displayType">
              <option *ngFor="let option of resourceTypeOptions" [value]="option.value">
                {{ currentLang === 'ar' ? option.icon + ' ' + option.labelAr : option.icon + ' ' + option.labelEn }}
              </option>
            </select>
            <div class="field-help">{{ currentLang === 'ar' ? 'ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±.' : 'You can adjust the file type after selecting a file if needed.' }}</div>
          </div>

          <div class="field-group">
            <label class="field-label" for="resourceFile">{{ currentLang === 'ar' ? 'ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù *' : 'Upload File *' }}</label>
            <input id="resourceFile" type="file" class="field-input" (change)="onResourceFileSelected($event)" />
            <div class="field-error" *ngIf="resourceUploadError">{{ resourceUploadError }}</div>
            <div class="resource-uploading" *ngIf="resourceUploading">
              <span class="resource-uploading-spinner"></span>
              <span>{{ currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù...' : 'Processing file...' }}</span>
            </div>
            <div class="resource-file-summary" *ngIf="resourceForm.fileName">
               <span class="resource-summary-icon">{{ getResourceIcon({ kind: resourceForm.displayType, fileName: resourceForm.fileName, fileType: resourceForm.fileType, fileSize: resourceForm.fileSize }) }}</span>
               <div class="resource-summary-details">
                 <span class="resource-summary-name">{{ getResourceDisplayLabelFromForm() }}</span>
                 <span class="resource-summary-meta">
                   <ng-container *ngFor="let entry of getResourceDetailEntriesFromForm(); let last = last">
                     <span class="resource-detail"><strong>{{ entry.label }}:</strong> {{ entry.value }}</span><span *ngIf="!last">{{ getResourceDetailSeparator() }}</span>
                   </ng-container>
                 </span>
               </div>
             </div>
          </div>

          <div class="field-group">
            <label class="field-label" for="resourceDescription">{{ currentLang === 'ar' ? 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯' : 'Resource Notes' }}</label>
            <textarea
              id="resourceDescription"
              rows="4"
              class="field-textarea"
              [(ngModel)]="resourceForm.description"
              [placeholder]="currentLang === 'ar' ? 'Ø£Ø¶Ù ÙˆØµÙØ§Ù‹ Ù‚ØµÙŠØ±Ø§Ù‹ Ø£Ùˆ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„Ù…ÙˆØ±Ø¯...' : 'Add a short description or instructions for the resource...'"
              [dir]="isRTL ? 'rtl' : 'ltr'"
              maxlength="600"></textarea>
            <div class="field-help">{{ currentLang === 'ar' ? 'Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.' : 'Add notes that help students use this resource effectively.' }}</div>
          </div>

          <div class="resource-preview-container" *ngIf="resourceForm.previewMode === 'inline' && resourceForm.dataUrl">
            <div class="resource-preview-header">
              <span class="preview-label">{{ currentLang === 'ar' ? 'Ù…Ø¹Ø§ÙŠÙ†Ø© Ø³Ø±ÙŠØ¹Ø©' : 'Quick Preview' }}</span>
              <span class="preview-hint">{{ currentLang === 'ar' ? 'Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ ÙÙ‚Ø·.' : 'Preview for reference only.' }}</span>
            </div>
            <div class="resource-preview-frame" *ngIf="resourceForm.displayType === 'pdf'">
              <iframe [src]="resourcePreviewSafeUrl" title="Resource preview" loading="lazy"></iframe>
            </div>
            <div class="resource-preview-frame" *ngIf="resourceForm.displayType === 'image'">
              <img [src]="resourceForm.dataUrl" [alt]="resourceForm.fileName" />
            </div>
          </div>

          <div class="resource-preview-placeholder" *ngIf="resourceForm.previewMode === 'download' && resourceForm.fileName">
            {{ currentLang === 'ar' ? 'Ù„Ù† ÙŠØªÙ… Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù. Ø³ÙŠÙƒÙˆÙ† Ù…ØªØ§Ø­Ø§Ù‹ Ù„Ù„ØªÙ†Ø²ÙŠÙ„.' : 'Preview is not available for this file. It will be provided as a download.' }}
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeResourceModal()">
            {{ currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
          </button>
          <button type="button" class="btn-save" (click)="submitResource()" [disabled]="resourceUploading || !resourceForm.title.trim() || !resourceForm.dataUrl">
            {{ currentLang === 'ar' ? 'Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ±Ø¯' : 'Save Resource' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Resource Preview Modal -->
    <div class="modal-overlay" *ngIf="showResourcePreviewModal" (click)="closeResourcePreview()">
      <div class="modal-content resource-preview-modal" (click)="$event.stopPropagation()" [dir]="isRTL ? 'rtl' : 'ltr'">
        <div class="modal-header">
          <h3>{{ currentLang === 'ar' ? 'Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ±Ø¯' : 'View Resource' }}</h3>
          <button type="button" class="modal-close-btn" (click)="closeResourcePreview()" [attr.aria-label]="currentLang === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'">âœ•</button>
        </div>
        <div class="modal-body" *ngIf="resourcePreviewItem">
          <div class="resource-preview-info">
            <div class="resource-preview-icon">{{ getResourceIcon(resourcePreviewItem.resourceDetails) }}</div>
            <div class="resource-preview-details">
              <span class="resource-preview-title">{{ resourcePreviewItem.title }}</span>
              <span class="resource-preview-meta">
                <ng-container *ngFor="let entry of getResourceDetailEntries(resourcePreviewItem.resourceDetails); let last = last">
                  <span class="resource-detail"><strong>{{ entry.label }}:</strong> {{ entry.value }}</span><span *ngIf="!last">{{ getResourceDetailSeparator() }}</span>
                </ng-container>
              </span>
              <span class="resource-preview-date">{{ (resourcePreviewItem.updatedAt || resourcePreviewItem.createdAt) | date:'medium' }}</span>
            </div>
          </div>

          <p class="resource-preview-description" *ngIf="resourcePreviewItem.resourceDetails?.description">{{ resourcePreviewItem.resourceDetails?.description }}</p>

          <div class="resource-preview-frame" *ngIf="resourcePreviewItem.resourceDetails?.previewMode === 'inline' && resourcePreviewSafeUrl">
            <ng-container [ngSwitch]="resourcePreviewKind">
              <iframe *ngSwitchCase="'pdf'" [src]="resourcePreviewSafeUrl" title="PDF preview" loading="lazy"></iframe>
              <img *ngSwitchCase="'image'" [src]="resourcePreviewItem.resourceDetails?.dataUrl" [alt]="resourcePreviewItem.resourceDetails?.fileName" />
              <iframe *ngSwitchDefault [src]="resourcePreviewSafeUrl" title="File preview" loading="lazy"></iframe>
            </ng-container>
          </div>

          <div class="resource-preview-placeholder" *ngIf="resourcePreviewItem.resourceDetails?.previewMode !== 'inline'">
            {{ currentLang === 'ar' ? 'Ù„Ø§ ØªØªÙˆÙØ± Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù. ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ†Ø²ÙŠÙ„Ù‡ Ù„Ø¹Ø±Ø¶Ù‡.' : 'Preview not available for this file. Download to view it.' }}
          </div>
        </div>
        <div class="modal-actions">
          <ng-container *ngIf="resourcePreviewItem?.resourceDetails as previewDetails">
            <a
              *ngIf="previewDetails.dataUrl"
              class="btn-primary"
              [href]="previewDetails.dataUrl"
              [attr.download]="getResourceDownloadName(previewDetails)">
              {{ currentLang === 'ar' ? 'ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù' : 'Download File' }}
            </a>
          </ng-container>
          <button type="button" class="btn-cancel" (click)="closeResourcePreview()">
            {{ currentLang === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close' }}
          </button>
        </div>
      </div>
    </div>
    </div>
  </div>

  <!-- Info Preview -->
  <div class="info-preview" *ngIf="selectedCategory">
    <h3>{{ currentLang === 'ar' ? 'Ø®Ø·ÙˆØ§Øª Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:' : 'Course Building Steps:' }}</h3>
    <div class="preview-grid">
      <div class="preview-item">
        <span class="preview-icon">ğŸ“</span>
        <span class="preview-title">{{ currentLang === 'ar' ? 'Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©' : 'Step 1: Course Basics' }}</span>
        <span class="preview-desc">{{ currentLang === 'ar' ? 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙˆØ§Ù„ÙˆØ­Ø¯Ø©' : 'Name and topic' }}</span>
      </div>
      <div class="preview-item">
        <span class="preview-icon">ğŸ¯</span>
        <span class="preview-title">{{ currentLang === 'ar' ? 'Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ù‚Ø³Ø§Ù…' : 'Step 2: Building Sections' }}</span>
        <span class="preview-desc">{{ currentLang === 'ar' ? 'Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…' : 'Build units and sections' }}</span>
      </div>
      <div class="preview-item">
        <span class="preview-icon">ğŸš€</span>
        <span class="preview-title">{{ currentLang === 'ar' ? 'Ø§Ù„Ø®Ø·ÙˆØ© 3: Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆÙ†Ø´Ø±' : 'Step 3: Review & Publish' }}</span>
        <span class="preview-desc">{{ currentLang === 'ar' ? 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø¤ÙŠØ© ÙˆØ§Ù„Ù†Ø´Ø± Ù…Ø¹ Ù‚Ø³Ù… Ø§Ø®ØªÙŠØ§Ø±ÙŠ' : 'Set visibility and publish with optional section' }}</span>
      </div>
    </div>
  </div>
</div>

<!-- Delete Section Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteSectionModal" (click)="cancelDeleteSection()">
  <div class="modal-content delete-section-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">{{ currentLang === 'ar' ? 'Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…ØŸ' : 'Delete this section?' }}</h2>
      <button type="button" class="modal-close" (click)="cancelDeleteSection()">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="delete-message">{{ currentLang === 'ar' ? 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙˆØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª Ø¨Ø¯Ø§Ø®Ù„Ù‡ Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ.' : 'This will permanently delete the section and everything inside it.' }}</p>
      <p class="delete-warning">{{ currentLang === 'ar' ? 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡. ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© delete Ù„Ù„ØªØ£ÙƒÙŠØ¯.' : 'This action cannot be undone. Please type delete to confirm.' }}</p>
      <p class="delete-section-name" *ngIf="sectionToDelete">{{ sectionToDelete.name }}</p>
      <div class="delete-confirm-field" *ngIf="sectionToDelete?.content_items?.length">
        <label for="delete-confirm-input">{{ currentLang === 'ar' ? 'Ø§ÙƒØªØ¨ delete Ù„Ù„ØªØ£ÙƒÙŠØ¯' : 'Type delete to confirm' }}</label>
        <input
          id="delete-confirm-input"
          type="text"
          [(ngModel)]="deleteConfirmationInput"
          (keydown.enter)="canConfirmDeleteSection() ? confirmDeleteSection() : null"
          [attr.placeholder]="deleteKeyword"
          autocomplete="off"
        />
      </div>
    </div>
    <div class="modal-actions">
      <button type="button" class="btn-cancel" (click)="cancelDeleteSection()">
        {{ currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
      </button>
      <button type="button" class="btn-delete" (click)="confirmDeleteSection()" [disabled]="sectionRequiresConfirmation() && !canConfirmDeleteSection()">
        {{ currentLang === 'ar' ? 'Ù†Ø¹Ù…ØŒ Ø­Ø°Ù' : 'Yes, delete' }}
      </button>
    </div>
  </div>
</div>

<!-- Start from Scratch Modal -->
<div class="modal-overlay" *ngIf="showStartFromScratchModal" (click)="showStartFromScratchModal = false">
  <div class="modal-content start-from-scratch-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">{{ currentLang === 'ar' ? 'Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯' : 'Start from Scratch' }}</h2>
      <button type="button" class="modal-close" (click)="showStartFromScratchModal = false">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="warning-message">{{ currentLang === 'ar' ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ØŸ' : 'Are you sure you want to delete everything and start from scratch?' }}</p>
      <p class="warning-details">{{ currentLang === 'ar' ? 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù…Ø§Ø¯Ø©ØŒ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…ØŒ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.' : 'All saved data will be deleted including course, sections, and content. This action cannot be undone.' }}</p>
    </div>
    <div class="modal-actions">
      <button type="button" class="btn-cancel" (click)="showStartFromScratchModal = false">
        {{ currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡' : 'Cancel' }}
      </button>
      <button 
        type="button" 
        class="btn-delete" 
        (click)="confirmStartFromScratch()"
        [disabled]="deletingDraftCourse"
        [attr.aria-busy]="deletingDraftCourse">
        <span *ngIf="deletingDraftCourse" class="btn-spinner" aria-hidden="true"></span>
        <span>{{ currentLang === 'ar' ? 'Ù†Ø¹Ù…ØŒ Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯' : 'Yes, Start from Scratch' }}</span>
      </button>
    </div>
  </div>
</div>

<!-- Undo Toast (shown after section deletion) -->
<div class="undo-toast" *ngIf="showUndoToast" [class.show]="showUndoToast" [dir]="isRTL ? 'rtl' : 'ltr'">
  <div class="toast-content">
    <span class="toast-message">{{ currentLang === 'ar' ? 'ØªÙ… Ø§Ù„Ø­Ø°Ù' : 'Section deleted' }}</span>
    <button type="button" class="btn-undo" (click)="undoDeleteSection()">
      {{ currentLang === 'ar' ? 'ØªØ±Ø§Ø¬Ø¹' : 'Undo' }}
    </button>
  </div>
</div>

<!-- Delete Cover Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteCoverModal" (click)="showDeleteCoverModal = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ deleteCoverTitle }}</h3>
      <button type="button" class="modal-close-btn" (click)="showDeleteCoverModal = false" [attr.aria-label]="currentLang === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'">âœ•</button>
    </div>
    <div class="modal-body">
      <p>{{ deleteCoverMessage }}</p>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" (click)="showDeleteCoverModal = false">
        {{ currentLang === 'ar' ? 'ØªØ±Ø§Ø¬Ø¹' : 'Cancel' }}
      </button>
      <button class="btn-confirm" (click)="confirmDeleteCover()" [disabled]="courseCoverUploading">
        {{ currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Delete' }}
      </button>
    </div>
  </div>
</div>

